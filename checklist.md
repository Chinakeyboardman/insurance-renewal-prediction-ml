# 客户续保预测分析项目

## 📋 项目背景

本次任务来自数据分析大赛，目标是帮助保险公司预测客户续保概率；
根据给出的训练集和测试集，进行数据分析，然后建立模型，最终达到模型可用来对新数据进行预测评分；
本项目难度极低，主要是展示个人的书写文档和工作习惯；

**要求：**
- 使用 Python 实现全流程，并保证可靠
- 全流程和分析结果保存在本目录内

---

## ✅ 任务清单

### 阶段一：数据探索

- [x] **任务1**: 编写Python代码，打开 `policy_data.xlsx` 读取前5行数据，显示全部列 ✅
- [x] **任务2**: 统计不同年龄层的续保比例 ✅
- [x] **任务3**: 用柱状图呈现不同年龄层的续保比例 ✅
- [x] **任务4**: 进行EDA（探索性数据分析） ✅

### 阶段二：逻辑回归建模

- [x] **任务5**: 编写Python代码，使用逻辑回归对 `renewal` 进行建模，打印逻辑回归的系数（全部），并进行可视化（能看出系数的正负） ✅
- [x] **任务6**: 打印全部的逻辑回归系数，确保显示完整 ✅
- [x] **任务7**: 帮我对逻辑回归的系数进行解释，即续保人群的画像，和不续保人群的画像，以及后续的对策，写入到 `.md` 文件 ✅

### 阶段三：决策树建模

- [x] **任务8**: 编写Python代码，使用决策树（depth=4）对 `renewal` 进行建模，打印决策树，并进行可视化 ✅
- [x] **任务9**: 帮我对决策树进行解释，即续保人群的画像，和不续保人群的画像，以及后续的对策，写入到 `.md` 文件 ✅
- [x] **任务10**: 对决策树模型打印验证集的准确性 ✅

### 阶段四：打分模型选型与开发

- [x] **任务11**: 打分模型方案选型，列出各方案优劣对比 ✅
- [x] **任务12**: 根据选定方案开发打分模型 ✅ (LightGBM优化版，测试集准确率92.67%，ROC-AUC 0.9618)
- [x] **任务13**: 实现评分转换和预测接口 ✅
- [ ] **任务14**: 对测试数据进行评分预测并评估效果

---

## 📊 数据文件

- `policy_data.xlsx` - 训练数据
- `policy_test.xlsx` - 测试数据

---

## 📝 执行记录

### ✅ 已完成任务总结

**阶段一：数据探索** ✅
- ✅ 任务1: 成功读取并显示前5行数据，共17列
- ✅ 任务2: 统计了6个年龄层的续保比例（20-29岁: 45.50%, 30-39岁: 98.85%, 40-49岁: 96.73%, 50-59岁: 100%, 60-69岁: 69.07%）
- ✅ 任务3: 生成了年龄层续保比例柱状图
- ✅ 任务4: 完成了全面的EDA分析，生成了4个可视化图表

**阶段二：逻辑回归建模** ✅
- ✅ 任务5: 建立了逻辑回归模型（准确率83.33%），打印并可视化了所有18个特征的系数
- ✅ 任务6: 所有系数已完整显示并保存到CSV文件
- ✅ 任务7: 生成了详细的逻辑回归系数解释报告（`logistic_regression_interpretation.md`）

**阶段三：决策树建模** ✅
- ✅ 任务8: 建立了决策树模型（max_depth=4，准确率91.33%，ROC-AUC: 0.9512），生成了决策树可视化图和文本表示
- ✅ 任务9: 生成了详细的决策树解释报告（`decision_tree_interpretation.md`）
- ✅ 任务10: 验证集准确率: **89.00%**，ROC-AUC: **0.9383**，模型泛化能力良好

### 📊 模型性能对比

| 模型 | 准确率 | ROC-AUC | 特点 |
|------|--------|---------|------|
| 逻辑回归 | 83.33% | - | 系数解释清晰，适合线性关系 |
| 决策树 | 91.33% | 0.9512 | 准确率更高，决策路径清晰 |
| **LightGBM（优化版）** | **92.67%** | **0.9618** | **最高准确率，参数已优化** |

### 📁 生成的文件

**数据文件**:
- `age_renewal_stats.csv`: 年龄层续保统计

**可视化图表**:
- `age_renewal_rate_chart.png`: 年龄层续保比例柱状图
- `eda_*.png`: EDA分析图表（4个）
- `lr_*.png`: 逻辑回归可视化图表（5个）
- `decision_tree_*.png`: 决策树可视化图表（5个）
- `lgbm_*_optimized.png`: LightGBM优化模型可视化图表（4个）

**模型文件**:
- `lr_all_coefficients.csv`: 逻辑回归所有系数
- `decision_tree_text.txt`: 决策树文本表示
- `lgbm/`: LightGBM相关文件目录
  - `task12_lgbm_scorecard.py`: LightGBM初始版本
  - `task12_lgbm_scorecard_v2.py`: LightGBM优化版本
  - `task13_score_prediction_api.py`: 评分转换和预测接口
  - `lgbm_scorecard_model_optimized.txt`: 优化后的模型文件
  - `lgbm_best_params.json`: 最佳参数配置
  - `label_encoders.pkl`: 特征编码器
  - `feature_names.pkl`: 特征名称列表
  - `lgbm_*_optimized.png`: 模型可视化图表（4个）

**报告文件**:
- `logistic_regression_interpretation.md`: 逻辑回归解释报告
- `decision_tree_interpretation.md`: 决策树解释报告
- `scorecard_model_selection.md`: 打分模型选型方案

### 🎯 关键发现

1. **年龄是最重要的因素**（决策树中重要性50.2%），中年客户（30-55岁）续保概率最高
2. **收入水平是最强的负向因子**（逻辑回归系数-1.678），低收入客户续保意愿明显较低
3. **家庭成员数是强正向因子**（逻辑回归系数+1.594），家庭成员越多，续保概率越高
4. **决策树模型表现更好**（准确率91.33% vs 83.33%），且决策路径清晰，易于应用
5. **LightGBM模型表现最佳**（准确率92.67%，ROC-AUC 0.9618），经过参数优化后泛化能力更强

**阶段四：打分模型选型与开发** ✅
- ✅ 任务11: 已完成打分模型选型方案（`scorecard_model_selection.md`），提供5种方案对比，最终选择LightGBM方案
- ✅ 任务12: 开发LightGBM打分模型
  - 初始版本（`task12_lgbm_scorecard.py`）: 测试集准确率92.67%，ROC-AUC 0.9637，但存在过拟合风险
  - 优化版本（`task12_lgbm_scorecard_v2.py`）: 通过参数优化，测试集准确率92.67%，ROC-AUC 0.9618，验证集AUC提升至0.9860
  - 最佳参数: num_leaves=15, learning_rate=0.05, 添加L1/L2正则化（reg_alpha=0.1, reg_lambda=0.1）
  - 模型文件已保存: `lgbm_scorecard_model_optimized.txt`
  - 生成可视化图表4个，特征重要性分析完成
- ✅ 任务13: 实现评分转换和预测接口
  - 创建了 `RenewalScorecard` 类，提供完整的预测接口
  - 实现概率到评分的转换（300-850分标准评分卡）
  - 支持单个样本和批量预测
  - 评分公式: Score = 600 + (20/ln(2)) × ln(odds)
  - 风险等级划分: 高风险(<500), 中风险(500-650), 低风险(650-800), 极低风险(800-850)
  - 接口文件: `task13_score_prediction_api.py`
